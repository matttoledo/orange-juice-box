---
# üçä Orange Juice Box - Deploy de Stacks
# Deploy todos os stacks do Docker Swarm

- name: Deploy Orange Juice Box Stacks
  hosts: swarm_managers
  become: no

  vars_files:
    - ../group_vars/production/secrets.yml

  tasks:
    - name: Verificar se Docker Swarm est√° ativo
      command: docker info --format '{{ '{{' }}.Swarm.LocalNodeState{{ '}}' }}'
      register: swarm_state
      changed_when: false

    - name: Falhar se Swarm n√£o estiver ativo
      assert:
        that:
          - swarm_state.stdout == "active"
        fail_msg: "Docker Swarm n√£o est√° ativo! Execute playbook setup-swarm.yml primeiro."

    - name: Banner
      debug:
        msg: "üöÄ Deploying Orange Juice Box Stacks..."

    # Note: Este √© um exemplo b√°sico
    # Os stacks reais devem ser deployados manualmente com docker stack deploy
    # porque precisam de .env files espec√≠ficos por stack

    - name: Informa√ß√£o
      debug:
        msg:
          - "Este playbook √© um exemplo b√°sico."
          - "Para deploy real dos stacks:"
          - "  cd stacks/security && docker stack deploy -c docker-compose.yml security"
          - "  cd stacks/verly && docker stack deploy -c docker-compose.yml verly"
          - "Ou use os scripts de deploy espec√≠ficos de cada stack."
